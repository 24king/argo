apiVersion: apps/v1
kind: Deployment
metadata:
  name: workflow-controller
spec:
  replicas: 2
  template:
    spec:
      containers:
        - name: workflow-controller
          imagePullPolicy: Always
          args:
            - --loglevel=warn
            - --configmap=workflow-controller-configmap
            - --executor-image=argoproj/argoexec:latest
            - --namespaced
            - --burst=2048
            - --qps=2048
            - --workflow-workers=256
            # v2.12
            # - --pod-cleanup-workers=32
            # beyond v2.12
            # - --workflow-ttl-workers=64
          env:
            #  - name: RECENTLY_STARTED_POD_DURATION
            #    value: 20s
            #  - name: DEFAULT_REQUEUE_TIME
            #    value: 2s
            #  - name: MAX_OPERATION_TIME
            #    value: 30s
            - name: INFORMER_WRITE_BACK
              value: ""
          # allow us to run <= v2.11 images
          securityContext:
            runAsNonRoot: true
            runAsUser: 8737
